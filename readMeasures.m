%*********************************************************************** 
%									 
%	-- Read data from a file generated by the LabView application
%
%	-> Usage = 
%		-> data = readMeasures(filename)
%
%	-> inputs =
%		-> filename - STRING defining name and location of file
%	
%	-> outputs = 	
%       -> data struct, containing the following 3 elements:
%			pow  - ARRAY OF FLOATS with measures of power (in dB)
%			time - ARRAY OF STRUCT with time of measures
%               time.hour    - day of measure
%               time.minute  - month of measure
%               time.second   - year of measure
%			att  - ARRAY OF FLOATS with attenuation levels of each measure
%									 
%	-> MATLAB version used:	
%		- R2012b (8.0.0.783) 64-bit	
%				 
% 	-> Special toolboxes used: 
%		-- none	--
%
% 	-> Other dependencies: 
%		- myCell2Mat.m
%									 
%	-> Created by Evandro Bernardes	 								 
%		- at ENSTA Bretagne (Brest, Britanny, France)							 								 
%		- In association with: 
%			ANFR - Agence Nationale de Fr√©quence    		 
%									 
% 	Code version:	5
%   - v2: addition of "myCell2Mat.m" script
%   - v3: substitution of string "time" type for struct
%   - v4: correction of "time" struct
%   - v5: definition of "data" struct
%
%	last edited in:	04/08/2016 					 
%									 
%*********************************************************************** 

% Function declaration
function data = readMeasures(filename)

	fileID = fopen(filename);
	
    % read measures as strings
	pattern = '%s %s %s';
    rawData = textscan(fileID,pattern);
    
    % extraction of "power" float array    
    pow = myCell2Mat(rawData{1});

    % extraction of "time" struct array    
    rawTime = cell2mat(rawData{2});
    
    hour = str2num(rawTime(:,1:2));
    minute = str2num(rawTime(:,4:5));
    second = str2num(rawTime(:,7:8));
    %time.x = str2num(rawTime(:,10:13));
    
    time = struct('hour',hour,'minute',minute,'second',second);
    
    % extraction of "attenuation" float array    
    att = myCell2Mat(rawData{3});
    
    % definition of "data" array
    data = struct('pow',pow,'time',time,'att',att);
end
