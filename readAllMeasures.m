%*********************************************************************** 
%									 
%	-- Read data from multiples files generated by the LabView application
%
%	-> Usage = 
%		-> [data,fileNames] = readAllMeasures(path,year,month,day)
%
%	-> inputs =
%		-> path  - STRING defining location of files
%		-> year  - STRING defining year
%		-> month - STRING defining month
%		-> day   - STRING defining day
%
%       OBS.: 'year', 'month' and 'day' must be either two-digit numbers
%       or '*' for wildcard
%	
%	-> outputs = 	
%       -> data  - STRUC, containing the following 3 elements:
%          = pow  - ARRAY OF FLOATS with measures of power (in dB)
%          = time - ARRAY OF STRUCT with time of measures
%                   time.year     - year of measure
%                   time.month    - month of measure
%                   time.day      - day of measure
%                   time.hour     - hour of measure
%                   time.minute   - minute of measure
%                   time.second   - second of measure
%                   time.sample   - number of sample
%          = att  - ARRAY OF FLOATS with attenuation levels of each measure
%
%       -> fileNames ARRAY OF STRINGS with names of loaded files
%									 
%	-> MATLAB version used:	
%		- R2012b (8.0.0.783) 64-bit	
%				 
% 	-> Special toolboxes used: 
%		-- none	--
%
% 	-> Other dependencies: 
%		- myCell2Mat.m
%		- readMeasures.m
%									 
%	-> Created by Evandro Bernardes	 								 
%		- at ENSTA Bretagne (Brest, Britanny, France)							 								 
%		- In association with: 
%			ANFR - Agence Nationale de Fr√©quence    		 
%									 
% 	Code version:	6
%   - v2: correction of "time" struct
%   - v3: definition of "data" struct
%   - v4: insertion of date in "time" struct
%   - v5: insertion of sample in "time" struct
%   - v6: check for wildcard option
%
%	last edited in:	22/08/2016 					 
%									 
%***********************************************************************

function [data,fileNames] = readAllMeasures(path,year,month,day)
    %% load files
    
    % checking for "wildcard" option
    if(isempty(year))
        year = '*'; end
    if(isempty(month))
        month = '*'; end
    if(isempty(day))
        day = '*'; end
    
    filesSelection = sprintf('%s%s%s%s.txt', path, year, month, day);

    files = dir(filesSelection);
    
    %% initialize vectors
    pow = [];
    att = [];
    
    year = [];
    month = [];
    day = [];
    hour = [];
    minute = [];
    second = [];
    sample = [];
    
    fileNames = {};
   
    for i = 1:length(files)
        fileNames{i} = files(i).name;
        ithFilePath = sprintf('%s%s', path, files(i).name);
        ithData = readMeasures(ithFilePath);

        pow = [pow;ithData.pow];
        att = [att;ithData.att];
        
        year = [year;ithData.time.year];
        month = [month;ithData.time.month];
        day = [day;ithData.time.day];
        hour = [hour;ithData.time.hour];
        minute = [minute;ithData.time.minute];
        second = [second;ithData.time.second];
        sample = [sample;ithData.time.sample];
        
    end
    
    %% final definition of data structure
    time = struct('year',year,'month',month,'day',day,'hour',hour,'minute',minute,'second',second,'sample',sample);
    data = struct('pow',pow,'time',time,'att',att);
end